<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>sim_met</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
<body>
    <div class="col-md-4" style="background-color: rgba(206, 210, 223, 0.226); padding-top: 400%;" ></div>
    <div class="col-md-4" style="padding-top: 0%;">
        <hr>
        <label style="width:100%; text-align: center;;">Решение задачи линейного программирования симплексным методом<br><br>Разработал студент группы АСОИ-181 Данилов Михаил</label>
        <hr>
        <table class="table table-bordered table-center">
            <tbody id="tab">
                <label id="lim">Начальная таблица: </label>
                <tr id="str"></tr>
                <tr id="tr1"></tr>
                <tr id="tr2"></tr>
                <tr id="tr3"></tr>
                <tr id="tr4"></tr>
                <tr id="tr5"></tr>
                <tr id="tr6"></tr>
                <tr id="tr7"></tr>
                <tr id="tr8"></tr>
                <tr id="tr9"></tr>
                <tr id="F"></tr>
            </tbody>
        </table>
        <div id="CenterBoss">
            
        </div>
        <div>
            <blockquote class="blockquote" id="answer">
                <p>Ответ: <span class="glyphicon glyphicon-ok" aria-hidden="true" style="color: rgb(33, 199, 33);" id="span"></span></p>

            </blockquote>
        </div>
    </div>
    <div class="col-md-4" style="background-color: rgba(206, 210, 223, 0.226); padding-top: 400%;"></div>
</body>
<script>
    lim.innerHTML += localStorage.getItem('limit')
    for(let i = 0;i<localStorage.getItem("sk");i++){
        for(let j = 0;j<=localStorage.getItem("sb");j++){
            if(i==0){
                if(j==0){
                    str.innerHTML += `<td>БП</td>`;
                    str.innerHTML += `<td>ЗБП</td>`;
                }
                else{str.innerHTML += `<td>-${localStorage.getItem(`x${j-1}`)}</td>`;}            
            }
            if(j==0){
                document.getElementById(`tr${i+1}`).innerHTML = `<td>${localStorage.getItem(`y${i}`)}</td>`;
                document.getElementById(`tr${i+1}`).innerHTML += localStorage.getItem(`T${i}${localStorage.getItem("sb")}`);
            }
            if(j==localStorage.getItem("sb")){
                continue;
            }
            document.getElementById(`tr${i+1}`).innerHTML += localStorage.getItem(`T${i}${j}`);
        }
    }
    for(let j = 0;j<=localStorage.getItem("sb");j++){
        if(j==0){
            F.innerHTML = `<td>F</td>`;
            F.innerHTML += localStorage.getItem(`f${localStorage.getItem("sb")}`);
        }
        if(j==localStorage.getItem("sb")){
            continue;
        }
        F.innerHTML += localStorage.getItem(`f${j}`);
    }
</script>
<script>
    for(let i = 0;i<localStorage.getItem("sk");i++){
        for(let j = 0;j<=localStorage.getItem("sb");j++){
            localStorage.setItem(`a${i}${j}`,document.getElementById(`T${i}${j}`).value);
        }
    }
    for(let j = 0;j<=localStorage.getItem("sb");j++){
        localStorage.setItem(`b${j}`,document.getElementById(`f${j}`).value);
    }
    let key = 0;
    let oll_negativ = true;
    outer: while(true){
        key++;
        let index_sb;
        let min_sb = [];
        let index_sr;
        let min_sr = [];
        // выбор метода решения
        let metod_opor;
        let metod_optimal;
        let metod_kanon;

        // метод metod_optimal
        for(let i = 0;i<localStorage.getItem("sb");i++){
            if(localStorage.getItem(`b${i}`)<0){
                metod_opor = false
                metod_optimal = true
                metod_kanon = false
            }
        }
        // метод metod_optimal


        // метод metod_opor
        for(let i = 0;i<localStorage.getItem("sk");i++){
            if(localStorage.getItem(`a${i}${localStorage.getItem("sb")}`)<0){
                metod_opor = true
                metod_optimal = false
                metod_kanon = false
            }
        }
        // метод metod_opor
        
        
        if(metod_optimal){
            // поиск оптимального эллемента
            let check_x = 0
            for(let i = 0;i<localStorage.getItem("sb");i++){
                min_sb.push(localStorage.getItem(`b${i}`));
                const negative = min_sb.filter(n => n < 0);
                negative.sort((a, b) => a - b);
                let min = negative[0]; // наименьшее из отрицательных
                if(localStorage.getItem(`b${i}`)==min){index_sb = i}
            }
            for(let j = 0;j<localStorage.getItem("sk");j++){
                localStorage.setItem(`co${j}`,Number(localStorage.getItem(`a${j}${localStorage.getItem("sb")}`))/Number(localStorage.getItem(`a${j}${index_sb}`)));
                if(localStorage.getItem(`co${j}`)<0||localStorage.getItem(`co${j}`)==Infinity){check_x++}
                min_sr.push(localStorage.getItem(`co${j}`));
                const positiv = min_sr.filter(n => (n > 0));
                positiv.sort((a, b) => a - b);
                let min = positiv[0]; // наименьшее из положительных
                if(localStorage.getItem(`co${j}`)==min){index_sr = j}
            }
            if(check_x==localStorage.getItem("sk")){
                oll_negativ = false;
                CenterBoss.innerHTML = '';
                span.classList = 'glyphicon glyphicon-remove'
                span.style.color = 'red'
                answer.innerHTML += `<footer>Нет решения</footer>`
                break outer;
            }
            optimal = localStorage.getItem(`a${index_sr}${index_sb}`);
            let kapa1 = localStorage.getItem(`x${index_sb}`);
            let kapa2 = localStorage.getItem(`y${index_sr}`);
            localStorage.setItem(`y${index_sr}`,kapa1);
            localStorage.setItem(`x${index_sb}`,kapa2);
            // поиск оптимального эллемента
        }
        if(metod_opor){
            // поиск оптимального эллемента
            net:for(let i = 0;i<localStorage.getItem("sk");i++){
                if(localStorage.getItem(`a${i}${localStorage.getItem("sb")}`)<0){
                    for(let j = 0;j<localStorage.getItem("sb");j++){
                        if(localStorage.getItem(`a${i}${j}`)<0){
                            index_sb=j;
                            break net;
                        }
                    }
                }
            }
            for(let j = 0;j<localStorage.getItem("sk");j++){
                localStorage.setItem(`co${j}`,Number(localStorage.getItem(`a${j}${localStorage.getItem("sb")}`))/Number(localStorage.getItem(`a${j}${index_sb}`)));
                min_sr.push(localStorage.getItem(`co${j}`));
                const positiv = min_sr.filter(n => n > 0);
                positiv.sort((a, b) => a - b);
                let min = positiv[0]; // наименьшее из положительных
                if(localStorage.getItem(`co${j}`)==min){index_sr = j}
            }
            optimal = localStorage.getItem(`a${index_sr}${index_sb}`);
            let kapa1 = localStorage.getItem(`x${index_sb}`);
            let kapa2 = localStorage.getItem(`y${index_sr}`);
            localStorage.setItem(`y${index_sr}`,kapa1);
            localStorage.setItem(`x${index_sb}`,kapa2);
            // поиск оптимального эллемента
            if(optimal==undefined){
                CenterBoss.innerHTML = '';
                span.classList = 'glyphicon glyphicon-remove'
                span.style.color = 'red'
                answer.innerHTML += `<footer>Нет решения</footer>`
                break outer;
            }
        }
        //расчёт новой таблицы
        let newTB =[];
        let temp;
        for(let i = 0;i<localStorage.getItem("sk");i++){
            for(let j = 0;j<=localStorage.getItem("sb");j++){
                temp = (localStorage.getItem(`a${i}${j}`)*optimal-localStorage.getItem(`a${index_sr}${j}`)*localStorage.getItem(`a${i}${index_sb}`))/optimal;
                localStorage.setItem(`TM${i}${j}`,temp.toFixed(2));
            }
        }
        for(let j = 0;j<=localStorage.getItem("sb");j++){
            temp = localStorage.getItem(`a${index_sr}${j}`)/optimal;
            localStorage.setItem(`TM${index_sr}${j}`,temp.toFixed(2));
        }
        for(let i = 0;i<localStorage.getItem("sk");i++){
            temp = -1*localStorage.getItem(`a${i}${index_sb}`)/optimal;
            localStorage.setItem(`TM${i}${index_sb}`,temp.toFixed(2));
        }

        localStorage.setItem(`TM${index_sr}${index_sb}`,(1/optimal).toFixed(2));

        for(let j = 0;j<=localStorage.getItem("sb");j++){
            temp = (localStorage.getItem(`b${j}`)*optimal-localStorage.getItem(`a${index_sr}${j}`)*localStorage.getItem(`b${index_sb}`))/optimal;
            localStorage.setItem(`TMF${j}`,temp.toFixed(2));
        }
        
        localStorage.setItem(`TMF${index_sb}`,(-1*localStorage.getItem(`b${index_sb}`)/optimal).toFixed(2))

        for(let i = 0;i<localStorage.getItem("sk");i++){
            for(let j = 0;j<=localStorage.getItem("sb");j++){
                localStorage.setItem(`a${i}${j}`,localStorage.getItem(`TM${i}${j}`));
            }
        }
        for(let j = 0;j<=localStorage.getItem("sb");j++){
            localStorage.setItem(`b${j}`,localStorage.getItem(`TMF${j}`));
        }
        //расчёт новой таблицы


        //запись в таблицу
        CenterBoss.innerHTML += `<label id="end${key}"></label>`
        CenterBoss.innerHTML += `<table class="table table-bordered table-center" id="boss${key}"></table>`;
        document.getElementById(`boss${key}`).innerHTML+=`<tbody id="tab${key}"></tbody>`;
        document.getElementById(`tab${key}`).innerHTML+=`<label id="label${key}">Таблица ${key}</label>
                    <tr id="str${key}1"></tr>
                    <tr id="end${key}1"></tr>
                    <tr id="end${key}2"></tr>
                    <tr id="end${key}3"></tr>
                    <tr id="end${key}4"></tr>
                    <tr id="end${key}5"></tr>
                    <tr id="end${key}6"></tr>
                    <tr id="end${key}7"></tr>
                    <tr id="end${key}8"></tr>
                    <tr id="end${key}9"></tr>
                    <tr id="F${key}1"></tr>`
        for(let i = 0;i<localStorage.getItem("sk");i++){
            for(let j = 0;j<=localStorage.getItem("sb");j++){
                if(i==0){
                    if(j==0){
                        document.getElementById(`str${key}1`).innerHTML += `<td>БП</td>`;
                        document.getElementById(`str${key}1`).innerHTML += `<td>ЗБП</td>`;
                    }
                    else{document.getElementById(`str${key}1`).innerHTML += `<td>-${localStorage.getItem(`x${j-1}`)}</td>`;}            
                }
                if(j==0){
                    document.getElementById(`end${key}${i+1}`).innerHTML = `<td>${localStorage.getItem(`y${i}`)}</td>`;
                    document.getElementById(`end${key}${i+1}`).innerHTML += `<td><input style="width:100%; text-align: center;" type="text" size="4" value="${localStorage.getItem(`a${i}${localStorage.getItem("sb")}`)}" id="TM${key}${i}${localStorage.getItem("sb")}" disabled></td>`;
                }
                if(j==localStorage.getItem("sb")){
                    continue;
                }
                document.getElementById(`end${key}${i+1}`).innerHTML += `<td><input style="width:100%; text-align: center;" type="text" size="4" value="${localStorage.getItem(`a${i}${j}`)}" id="TM${key}${i}${j}" disabled></td>`;
            }
        }


        for(let j = 0;j<=localStorage.getItem("sb");j++){
            if(j==0){
                document.getElementById(`F${key}1`).innerHTML = `<td>F</td>`;
                document.getElementById(`F${key}1`).innerHTML += `<td><input style="width:100%; text-align: center;" type="text" size="4" value="${localStorage.getItem(`b${localStorage.getItem(`sb`)}`)}" id="TMF${j}" disabled></td>`;
            }
            if(j==localStorage.getItem("sb")){
                continue;
            }
            document.getElementById(`F${key}1`).innerHTML += `<td><input style="width:100%; text-align: center;" type="text" size="4" value="${localStorage.getItem(`b${j}`)}" id="TMF${j}" disabled></td>`;
        }
        if(key==1){
            document.getElementById(`T${index_sr}${index_sb}`).style.backgroundColor = 'orange';
        }
        else{
            document.getElementById(`TM${key-1}${index_sr}${index_sb}`).style.backgroundColor = 'orange';
        }
        //запись в таблицу


        // проверка на положительность
        let drive = 0;
        let drive1 = 0;
        let boll = 0;
        for(let i = 0;i<localStorage.getItem("sk");i++){
            if(localStorage.getItem(`a${i}${localStorage.getItem("sb")}`)>=0){
                drive++
            }
            if(drive == localStorage.getItem("sk")){boll++}
        }
        for(let i = 0;i<localStorage.getItem("sb");i++){
            if(localStorage.getItem(`b${i}`)>=0){drive1++}
            if(drive1 == localStorage.getItem("sb")){boll++}
        }
        // проверка на положительность
        if(boll==2){
            document.getElementById(`label${key}`).outerHTML = ``
            document.getElementById(`end${key}`).innerHTML = `Конечная таблица номер ${key}`
            if(localStorage.getItem('limit')=='min'){
                localStorage.setItem(`b${localStorage.getItem('sb')}`,-1*localStorage.getItem(`b${localStorage.getItem('sb')}`))
            }
            break outer;
        }
    }
    if(optimal!=undefined&&oll_negativ){
        for(let i = 0;i<localStorage.getItem('sk');i++){
            if(localStorage.getItem(`y${i}`).substr(0, 1)==`x`){
            answer.innerHTML += `<footer>${localStorage.getItem(`y${i}`).substr(0, 2)+" = "+localStorage.getItem(`a${i}${localStorage.getItem('sb')}`)}</footer>`
            }
        }
        for(let i = 0;i<localStorage.getItem('sb');i++){
            if(localStorage.getItem(`x${i}`).substr(0, 1)==`x`){
            answer.innerHTML += `<footer>${localStorage.getItem(`x${i}`).substr(0, 2)+" = 0"}</footer>`
            }
        }
        answer.innerHTML += `<footer>${"F = "+localStorage.getItem(`b${localStorage.getItem('sb')}`)}</footer>`
    }
    
</script>
<script src="js/transfer.js"></script>
</html>